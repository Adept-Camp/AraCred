"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _apm = _interopRequireDefault(require("@aragon/apm"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Return packages for a given APM registry.
 * `progressHandler` can be called with 2 values:
 * - 1: Fetching APM Registry
 * - 2: Gathering packages in registry
 *
 * @param {Object} web3 web3
 * @param {string} apmRegistryName APM registry name
 * @param {Object} apmOptions APM options
 * @param {function(number)} progressHandler Progress handler
 * @returns {void}
 */
var _default = async (web3, apmRegistryName, apmOptions, progressHandler = () => {}) => {
  const apm = await (0, _apm.default)(web3, apmOptions);
  progressHandler(1);
  const registry = await apm.getRepoRegistry(`vault.${apmRegistryName}`);
  const newRepoEvents = await registry.getPastEvents('NewRepo', {
    fromBlock: 0
  });
  progressHandler(2);
  const packages = await Promise.all(newRepoEvents.map(async event => {
    const args = event.returnValues;
    return {
      name: args.name,
      version: (await apm.getLatestVersion(args.id)).version
    };
  }));
  return packages;
};

exports.default = _default;
//# sourceMappingURL=getApmRegistryPackages.js.map