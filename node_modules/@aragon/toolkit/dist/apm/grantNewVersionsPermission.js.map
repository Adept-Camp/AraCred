{"version":3,"sources":["../../src/apm/grantNewVersionsPermission.js"],"names":["web3","apmRepoName","apmOptions","grantees","progressHandler","gasPrice","length","Error","apm","acl","repo","getRepository","receipts","address","accounts","eth","getAccounts","from","transaction","grant","options","receipt","sendTransaction","transactionHash","push"],"mappings":";;;;;;;AAAA;;AACA;;;;eAEe,OACbA,IADa,EAEbC,WAFa,EAGbC,UAHa,EAIbC,QAJa,EAKbC,eAAe,GAAG,MAAM,CAAE,CALb,EAMb;AAAEC,EAAAA;AAAF,CANa,KAOV;AACH,MAAIF,QAAQ,CAACG,MAAT,KAAoB,CAAxB,EAA2B;AACzB,UAAM,IAAIC,KAAJ,CAAU,+BAAV,CAAN;AACD;;AAED,QAAMC,GAAG,GAAG,MAAM,kBAAIR,IAAJ,EAAUE,UAAV,CAAlB;AACA,QAAMO,GAAG,GAAG,kBAAIT,IAAJ,CAAZ;AAEAI,EAAAA,eAAe,CAAC,CAAD,CAAf;AAEA,QAAMM,IAAI,GAAG,MAAMF,GAAG,CAACG,aAAJ,CAAkBV,WAAlB,CAAnB;;AACA,MAAIS,IAAI,KAAK,IAAb,EAAmB;AACjB,UAAM,IAAIH,KAAJ,CACH,cAAaN,WAAY,kDADtB,CAAN;AAGD;;AAED,QAAMW,QAAQ,GAAG,EAAjB;AAEA;;AACA,OAAK,MAAMC,OAAX,IAAsBV,QAAtB,EAAgC;AAC9BC,IAAAA,eAAe,CAAC,CAAD,EAAIS,OAAJ,CAAf,CAD8B,CAG9B;;AACA,UAAMC,QAAQ,GAAG,MAAMd,IAAI,CAACe,GAAL,CAASC,WAAT,EAAvB;AACA,UAAMC,IAAI,GAAGH,QAAQ,CAAC,CAAD,CAArB,CAL8B,CAO9B;;AACA,UAAMI,WAAW,GAAG,MAAMT,GAAG,CAACU,KAAJ,CAAUT,IAAI,CAACU,OAAL,CAAaP,OAAvB,EAAgCA,OAAhC,CAA1B;AAEAK,IAAAA,WAAW,CAACD,IAAZ,GAAmBA,IAAnB;AACAC,IAAAA,WAAW,CAACb,QAAZ,GAAuBA,QAAvB,CAX8B,CAY9B;;AAEA,UAAMgB,OAAO,GAAG,MAAMrB,IAAI,CAACe,GAAL,CAASO,eAAT,CAAyBJ,WAAzB,CAAtB;AACAd,IAAAA,eAAe,CAAC,CAAD,EAAIiB,OAAO,CAACE,eAAZ,CAAf;AAEAX,IAAAA,QAAQ,CAACY,IAAT,CAAcH,OAAd;AACD;;AAED,SAAOT,QAAP;AACD,C","sourcesContent":["import APM from '@aragon/apm'\nimport ACL from './util/acl'\n\nexport default async (\n  web3,\n  apmRepoName,\n  apmOptions,\n  grantees,\n  progressHandler = () => {},\n  { gasPrice }\n) => {\n  if (grantees.length === 0) {\n    throw new Error('No grantee addresses provided')\n  }\n\n  const apm = await APM(web3, apmOptions)\n  const acl = ACL(web3)\n\n  progressHandler(1)\n\n  const repo = await apm.getRepository(apmRepoName)\n  if (repo === null) {\n    throw new Error(\n      `Repository ${apmRepoName} does not exist and it's registry does not exist`\n    )\n  }\n\n  const receipts = []\n\n  /* eslint-disable-next-line */\n  for (const address of grantees) {\n    progressHandler(2, address)\n\n    // Decode sender\n    const accounts = await web3.eth.getAccounts()\n    const from = accounts[0]\n\n    // Build transaction\n    const transaction = await acl.grant(repo.options.address, address)\n\n    transaction.from = from\n    transaction.gasPrice = gasPrice\n    // the recommended gasLimit is already calculated by the ACL module\n\n    const receipt = await web3.eth.sendTransaction(transaction)\n    progressHandler(3, receipt.transactionHash)\n\n    receipts.push(receipt)\n  }\n\n  return receipts\n}\n"],"file":"grantNewVersionsPermission.js"}