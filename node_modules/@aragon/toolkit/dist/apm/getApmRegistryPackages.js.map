{"version":3,"sources":["../../src/apm/getApmRegistryPackages.js"],"names":["web3","apmRegistryName","apmOptions","progressHandler","apm","registry","getRepoRegistry","newRepoEvents","getPastEvents","fromBlock","packages","Promise","all","map","event","args","returnValues","name","version","getLatestVersion","id"],"mappings":";;;;;;;AAAA;;;;AAEA;;;;;;;;;;;;eAYe,OACbA,IADa,EAEbC,eAFa,EAGbC,UAHa,EAIbC,eAAe,GAAG,MAAM,CAAE,CAJb,KAKV;AACH,QAAMC,GAAG,GAAG,MAAM,kBAAIJ,IAAJ,EAAUE,UAAV,CAAlB;AAEAC,EAAAA,eAAe,CAAC,CAAD,CAAf;AAEA,QAAME,QAAQ,GAAG,MAAMD,GAAG,CAACE,eAAJ,CAAqB,SAAQL,eAAgB,EAA7C,CAAvB;AAEA,QAAMM,aAAa,GAAG,MAAMF,QAAQ,CAACG,aAAT,CAAuB,SAAvB,EAAkC;AAC5DC,IAAAA,SAAS,EAAE;AADiD,GAAlC,CAA5B;AAIAN,EAAAA,eAAe,CAAC,CAAD,CAAf;AAEA,QAAMO,QAAQ,GAAG,MAAMC,OAAO,CAACC,GAAR,CACrBL,aAAa,CAACM,GAAd,CAAkB,MAAMC,KAAN,IAAe;AAC/B,UAAMC,IAAI,GAAGD,KAAK,CAACE,YAAnB;AACA,WAAO;AACLC,MAAAA,IAAI,EAAEF,IAAI,CAACE,IADN;AAELC,MAAAA,OAAO,EAAE,CAAC,MAAMd,GAAG,CAACe,gBAAJ,CAAqBJ,IAAI,CAACK,EAA1B,CAAP,EAAsCF;AAF1C,KAAP;AAID,GAND,CADqB,CAAvB;AAUA,SAAOR,QAAP;AACD,C","sourcesContent":["import APM from '@aragon/apm'\n\n/**\n * Return packages for a given APM registry.\n * `progressHandler` can be called with 2 values:\n * - 1: Fetching APM Registry\n * - 2: Gathering packages in registry\n *\n * @param {Object} web3 web3\n * @param {string} apmRegistryName APM registry name\n * @param {Object} apmOptions APM options\n * @param {function(number)} progressHandler Progress handler\n * @returns {void}\n */\nexport default async (\n  web3,\n  apmRegistryName,\n  apmOptions,\n  progressHandler = () => {}\n) => {\n  const apm = await APM(web3, apmOptions)\n\n  progressHandler(1)\n\n  const registry = await apm.getRepoRegistry(`vault.${apmRegistryName}`)\n\n  const newRepoEvents = await registry.getPastEvents('NewRepo', {\n    fromBlock: 0,\n  })\n\n  progressHandler(2)\n\n  const packages = await Promise.all(\n    newRepoEvents.map(async event => {\n      const args = event.returnValues\n      return {\n        name: args.name,\n        version: (await apm.getLatestVersion(args.id)).version,\n      }\n    })\n  )\n\n  return packages\n}\n"],"file":"getApmRegistryPackages.js"}