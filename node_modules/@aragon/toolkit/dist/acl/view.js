"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getDaoAddressPermissionsApps = void 0;

require("../../@types/acl/typedef");

var _aragonjsWrapper = require("../helpers/aragonjs-wrapper");

const getDaoAddressPermissionsApps = ({
  dao,
  web3Provider,
  ipfsConf,
  apm
}) => {
  return new Promise((resolve, reject) => {
    /**
     * @type {AclPermissions}
     */
    let permissions;
    /**
     * @type {App[]}
     */

    let apps;
    /**
     * @type {string}
     */

    let daoAddress;

    const resolveIfReady = () => {
      if (permissions && apps && daoAddress) {
        resolve({
          permissions,
          apps,
          daoAddress
        });
      }
    };

    (0, _aragonjsWrapper.initAragonJS)(dao, apm.ensRegistryAddress, {
      provider: web3Provider,
      ipfsConf,
      onPermissions: _permissions => {
        permissions = _permissions;
        resolveIfReady();
      },
      onDaoAddress: addr => {
        daoAddress = addr;
        resolveIfReady();
      }
    }).then(async wrapper => {
      apps = await (0, _aragonjsWrapper.getApps)(wrapper);
      resolveIfReady();
    }).catch(err => {
      err.message = `Error inspecting DAO ${err.message}`;
      reject(err);
    });
  });
};

exports.getDaoAddressPermissionsApps = getDaoAddressPermissionsApps;
//# sourceMappingURL=view.js.map