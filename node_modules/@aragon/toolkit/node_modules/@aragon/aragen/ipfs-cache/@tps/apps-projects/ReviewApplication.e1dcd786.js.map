{"version":3,"sources":["components/Panel/ReviewApplication/ReviewApplication.js","components/Panel/ReviewApplication/index.js"],"names":["ReviewApplication","issue","requestIndex","readOnly","githubCurrentUser","api","reviewApplication","closePanel","theme","feedback","setFeedback","index","setIndex","onReviewApplication","review","approved","today","Date","user","reviewDate","toISOString","buildReturnData","ipfsData","requestsData","requestIPFSHash","repoId","number","contributorAddr","toPromise","request","application","login","name","avatarUrl","url","workplan","hours","eta","applicationDate","applicant","applicantName","applicationDateDistance","GU","map","background","border","margin","length","e","target","value","propTypes","issueShape","PropTypes","isRequired","bool","Estimations","styled","div"],"mappings":";AAgLeA,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,aAAAA,EAAAA,IAAAA,EAAAA,EAAAA,QAAAA,0CA9Kf,EAAA,EAAA,QAAA,sBAFA,EAAA,EAAA,QAAA,UACA,EAAA,EAAA,QAAA,eAEA,EAAA,QAAA,YACA,EAAA,QAAA,cAOA,EAAA,QAAA,cACA,EAAA,EAAA,QAAA,iCACA,EAAA,QAAA,sBACA,EAAA,QAAA,eACA,EAAA,QAAA,+BACA,EAAA,QAAA,cACA,EAAA,QAAA,4BACA,EAAA,QAAA,+BACA,EAAA,QAAA,sBA6JeA,SAAAA,IAAAA,GAAAA,mBAAAA,QAAAA,OAAAA,KAAAA,IAAAA,EAAAA,IAAAA,QAAAA,OAAAA,EAAAA,WAAAA,OAAAA,GAAAA,EAAAA,SAAAA,EAAAA,GAAAA,GAAAA,GAAAA,EAAAA,WAAAA,OAAAA,EAAAA,GAAAA,OAAAA,GAAAA,iBAAAA,GAAAA,mBAAAA,EAAAA,MAAAA,CAAAA,QAAAA,GAAAA,IAAAA,EAAAA,IAAAA,GAAAA,GAAAA,EAAAA,IAAAA,GAAAA,OAAAA,EAAAA,IAAAA,GAAAA,IAAAA,EAAAA,GAAAA,EAAAA,OAAAA,gBAAAA,OAAAA,yBAAAA,IAAAA,IAAAA,KAAAA,EAAAA,GAAAA,OAAAA,UAAAA,eAAAA,KAAAA,EAAAA,GAAAA,CAAAA,IAAAA,EAAAA,EAAAA,OAAAA,yBAAAA,EAAAA,GAAAA,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,KAAAA,OAAAA,eAAAA,EAAAA,EAAAA,GAAAA,EAAAA,GAAAA,EAAAA,GAAAA,OAAAA,EAAAA,QAAAA,EAAAA,GAAAA,EAAAA,IAAAA,EAAAA,GAAAA,EAAAA,SAAAA,EAAAA,GAAAA,OAAAA,GAAAA,EAAAA,WAAAA,EAAAA,CAAAA,QAAAA,GAAAA,SAAAA,EAAAA,EAAAA,GAAAA,IAAAA,EAAAA,OAAAA,KAAAA,GAAAA,GAAAA,OAAAA,sBAAAA,CAAAA,IAAAA,EAAAA,OAAAA,sBAAAA,GAAAA,IAAAA,EAAAA,EAAAA,OAAAA,SAAAA,GAAAA,OAAAA,OAAAA,yBAAAA,EAAAA,GAAAA,cAAAA,EAAAA,KAAAA,MAAAA,EAAAA,GAAAA,OAAAA,EAAAA,SAAAA,EAAAA,GAAAA,IAAAA,IAAAA,EAAAA,EAAAA,EAAAA,UAAAA,OAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAAA,UAAAA,GAAAA,UAAAA,GAAAA,GAAAA,EAAAA,EAAAA,EAAAA,OAAAA,IAAAA,GAAAA,QAAAA,SAAAA,IAAAA,EAAAA,EAAAA,SAAAA,EAAAA,EAAAA,EAAAA,MAAAA,OAAAA,0BAAAA,OAAAA,iBAAAA,EAAAA,OAAAA,0BAAAA,IAAAA,EAAAA,OAAAA,IAAAA,QAAAA,SAAAA,GAAAA,OAAAA,eAAAA,EAAAA,EAAAA,OAAAA,yBAAAA,EAAAA,MAAAA,OAAAA,EAAAA,IAAAA,EAAAA,EAAAA,QAAAA,IAAAA,WAAAA,CAAAA,YAAAA,gCAAAA,YAAAA,eAAAA,CAAAA,CAAAA,UAAAA,QAAAA,GAAAA,EAAAA,MAAAA,GAAAA,EAAAA,EAAAA,SAAAA,EAAAA,UAAAA,WAAAA,CAAAA,YAAAA,qCAAAA,YAAAA,eAAAA,CAAAA,CAAAA,iBAAAA,MAAAA,GAAAA,EAAAA,OAnJf,MAAMA,EAAoB,EAAGC,MAAAA,EAAOC,aAAAA,EAAcC,SAAAA,MAC1CC,MAAAA,GAAoB,EAA1B,EAAA,YAEEC,KAAK,kBAAEC,KACL,EAFJ,EAAA,iBAGM,WAAEC,IAAe,EAAvB,EAAA,sBACMC,GAAQ,EAAd,EAAA,aAEQC,EAAUC,IAAgB,EAAS,EAAA,UAAA,KACnCC,EAAOC,IAAa,EAASV,EAAAA,UAAAA,GAkB/BW,EAAsB,MAAA,IAC1BN,IACMO,MAAAA,EAhBgBC,CAAAA,IAChBC,MAAAA,EAAQ,IAAIC,KACX,MAAA,CACLR,SAAAA,EACAM,SAAAA,EACAG,KAAMd,EACNe,WAAYH,EAAMI,gBAULC,CAAgBN,GAEzBO,EAAWrB,EAAMsB,aAAaZ,GAC9Ba,QAAwB,EAAaF,EAAAA,SAAAA,EAAAA,GAAAA,EAAb,CAAuBR,OAAAA,KAErDR,GACE,EAAML,EAAAA,OAAAA,EAAMwB,QACZxB,EAAMyB,OACNzB,EAAMsB,aAAaZ,GAAOgB,gBAC1BH,EACAT,GACAa,aAGEC,EAAU5B,EAAMsB,aAAaZ,GAC7BmB,EAAc,CAClBZ,KAAM,CACJa,MAAOF,EAAQX,KAAKa,MACpBC,KAAMH,EAAQX,KAAKc,KACnBC,UAAWJ,EAAQX,KAAKe,UACxBC,IAAKL,EAAQX,KAAKgB,KAEpBC,SAAUN,EAAQM,SAClBC,MAAOP,EAAQO,MACfC,IAAsB,MAAhBR,EAAQQ,IAAeR,EAAQQ,KAAM,EAAW,EAAA,QAAA,IAAIpB,KAAKY,EAAQQ,KAAM,SAC7EC,gBAAiBT,EAAQS,iBAGrBC,EAAYT,EAAYZ,KACxBsB,EAAgBD,EAAUP,KAAOO,EAAUP,KAAOO,EAAUR,MAC5DU,GAA0B,EAAe,EAAA,gBAAA,IAAIxB,KAAKa,EAAYQ,iBAAkB,IAAIrB,MAGxF,OAAA,EAAA,QAAA,cAAA,EAAA,CAAqB,KAAA,EAAIyB,EAAAA,IACvB,EAAC,QAAA,cAAA,EAAD,WAAA,CAAY,MAAOzC,IAEnB,EAAC,QAAA,cAAA,EAAD,WAHF,KAAA,aAIE,EAAA,QAAA,cAAA,EAAA,CACE,KAAK,YACL,MAAOA,EAAMsB,aAAaoB,IAAId,GAAWA,EAAQX,KAAKa,OACtD,SA5CiBpB,GAAUC,EAASD,GA6CpC,SAAUA,EACV,MALF,EAMyB,MAAA,EAAI+B,EAAAA,KAG7B,EAAC,QAAA,cAAA,EAAD,kBAAA,CAAmB,cAAelC,EAAMoC,aAAc,UAAWpC,EAAMqC,UACrE,EAAC,QAAA,cAAA,EAAD,SACE,KAAA,EAAC,QAAA,cAAA,EAAD,OAAA,CAAQ,KAAMN,IACbC,EAAwBC,YAAAA,EAH7B,QAME,EAAC,QAAA,cAAA,EAAD,WANF,KAAA,aAOE,EAAC,QAAA,cAAA,EAAD,gBAAkBX,KAAAA,EAAYK,UAE9B,EAAC,QAAA,cAAA,EACC,KAAA,EACE,QAAA,cAAA,MAAA,KAAA,EAAC,QAAA,cAAA,EAAD,WADF,KAAA,mBAEE,EAAC,QAAA,cAAA,EAAD,KAAOL,KAAAA,EAAYM,QAErB,EACE,QAAA,cAAA,MAAA,KAAA,EAAC,QAAA,cAAA,EAAD,WADF,KAAA,kBAEE,EAAC,QAAA,cAAA,EAAD,KAAON,KAAAA,EAAYO,QAKvB,WAAYR,GACZ,EAAC,QAAA,cAAA,EAAD,QAAO,SACL,KAAA,EAAC,QAAA,cAAA,EAAD,WADF,KAAA,sBAGE,EAAC,QAAA,cAAA,EAAD,UACE,KAAA,EAAC,QAAA,cAAA,EAAD,OAAA,CAAQ,WAAYA,EAAQf,OAAOK,WAAY,SAAUU,EAAQf,OAAOC,YAG1E,EAAC,QAAA,cAAA,EAAD,WAPF,KAAA,YAQE,EAAC,QAAA,cAAA,EAAD,KAAM,MAAN,CAAY,MAAO,CAAE+B,OAAQ,WAC1BjB,EAAQf,OAAOL,SAASsC,OAASlB,EAAQf,OAAOL,SAAW,8BAIhEN,IAAa0B,EAAQf,QACrB,EAAC,QAAA,cAAA,EAAD,QAAO,SACL,KAAA,EAAC,QAAA,cAAA,EAAD,UAAA,CACE,MAAM,WACN,MACE,EAAC,QAAA,cAAA,EAAD,UAAW,UAAX,CACE,KAAK,WACL,KAAK,IACL,SA3GSkC,GAAKtC,EAAYsC,EAAEC,OAAOC,OA4GnC,YAAY,qDACZ,MAAOzC,EACP,MAAI,MAKV,EAAC,QAAA,cAAA,EAAD,cAAA,CAAe,SAvGN,IAAMI,GAAoB,GAuGA,SAtG1B,IAAMA,GAAoB,GAsGoB,UAAU,OAQ3Eb,EAAkBmD,UAAY,CAC5BlD,MAAOmD,EADqB,WAE5BlD,aAAcmD,EAAU3B,QAAAA,OAAO4B,WAC/BnD,SAAUkD,EAAUE,QAAAA,KAAKD,YAG3B,MAAME,EAAcC,EAAOC,QAAAA,IAAV,WAAA,CAAA,YAAA,iCAAA,YAAA,eAAGD,CAApB,CAAA,sFAOezD,IAAAA,EAAAA,EAAAA,QAAAA,QAAAA;;AC/Kf,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,OAAA,eAAA,QAAA,UAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,WAAA,IAAA,EAAA,EAAA,QAAA,wBAAA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA","file":"ReviewApplication.e1dcd786.js","sourceRoot":"../app","sourcesContent":["import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport { format as formatDate, formatDistance } from 'date-fns'\nimport {\n  DropDown,\n  GU,\n  Text,\n  TextInput,\n  useTheme,\n} from '@aragon/ui'\nimport { FormField, FieldTitle } from '../../Form'\nimport useGithubAuth from '../../../hooks/useGithubAuth'\nimport { useAragonApi } from '../../../api-react'\nimport { usePanelManagement } from '../../Panel'\nimport { ipfsAdd } from '../../../utils/ipfs-helpers'\nimport { toHex } from 'web3-utils'\nimport { issueShape } from '../../../utils/shapes.js'\nimport { DetailHyperText } from '../../../../../../shared/ui'\nimport {\n  Avatar,\n  FieldText,\n  IssueTitle,\n  ReviewButtons,\n  Status,\n  SubmissionDetails,\n  UserLink,\n} from '../PanelComponents'\n\nconst ReviewApplication = ({ issue, requestIndex, readOnly }) => {\n  const githubCurrentUser = useGithubAuth()\n  const {\n    api: { reviewApplication },\n  } = useAragonApi()\n  const { closePanel } = usePanelManagement()\n  const theme = useTheme()\n\n  const [ feedback, setFeedback ] = useState('')\n  const [ index, setIndex ] = useState(requestIndex)\n\n  const updateFeedback = e => setFeedback(e.target.value)\n\n  const buildReturnData = approved => {\n    const today = new Date()\n    return {\n      feedback,\n      approved,\n      user: githubCurrentUser,\n      reviewDate: today.toISOString(),\n    }\n  }\n\n  const onAccept = () => onReviewApplication(true)\n  const onReject = () => onReviewApplication(false)\n  const changeRequest = (index) => setIndex(index)\n\n  const onReviewApplication = async (approved) => {\n    closePanel()\n    const review = buildReturnData(approved)\n    // new IPFS data is old data plus state returned from the panel\n    const ipfsData = issue.requestsData[index]\n    const requestIPFSHash = await ipfsAdd({ ...ipfsData, review })\n\n    reviewApplication(\n      toHex(issue.repoId),\n      issue.number,\n      issue.requestsData[index].contributorAddr,\n      requestIPFSHash,\n      approved\n    ).toPromise()\n  }\n\n  const request = issue.requestsData[index]\n  const application = {\n    user: {\n      login: request.user.login,\n      name: request.user.name,\n      avatarUrl: request.user.avatarUrl,\n      url: request.user.url\n    },\n    workplan: request.workplan,\n    hours: request.hours,\n    eta: (request.eta === '-') ? request.eta : formatDate(new Date(request.eta), 'MMM d'),\n    applicationDate: request.applicationDate\n  }\n\n  const applicant = application.user\n  const applicantName = applicant.name ? applicant.name : applicant.login\n  const applicationDateDistance = formatDistance(new Date(application.applicationDate), new Date())\n\n  return (\n    <div css={`margin: ${2 * GU}px 0`}>\n      <IssueTitle issue={issue} />\n\n      <FieldTitle>Applicant</FieldTitle>\n      <DropDown\n        name=\"Applicant\"\n        items={issue.requestsData.map(request => request.user.login)}\n        onChange={changeRequest}\n        selected={index}\n        wide\n        css={`margin-bottom: ${3 * GU}px`}\n      />\n\n      <SubmissionDetails background={`${theme.background}`} border={`${theme.border}`}>\n        <UserLink>\n          <Avatar user={applicant} />\n          {applicantName} applied {applicationDateDistance} ago\n        </UserLink>\n\n        <FieldTitle>Work Plan</FieldTitle>\n        <DetailHyperText>{application.workplan}</DetailHyperText>\n\n        <Estimations>\n          <div>\n            <FieldTitle>Estimated Hours</FieldTitle>\n            <Text>{application.hours}</Text>\n          </div>\n          <div>\n            <FieldTitle>Estimated Date</FieldTitle>\n            <Text>{application.eta}</Text>\n          </div>\n        </Estimations>\n      </SubmissionDetails>\n\n      {('review' in request) && (\n        <React.Fragment>\n          <FieldTitle>Application Status</FieldTitle>\n\n          <FieldText>\n            <Status reviewDate={request.review.reviewDate} approved={request.review.approved} />\n          </FieldText>\n\n          <FieldTitle>Feedback</FieldTitle>\n          <Text.Block style={{ margin: '10px 0' }}>\n            {request.review.feedback.length ? request.review.feedback : 'No feedback was provided'}\n          </Text.Block>\n        </React.Fragment>\n      )}\n      {!readOnly && !request.review && (\n        <React.Fragment>\n          <FormField\n            label=\"Feedback\"\n            input={\n              <TextInput.Multiline\n                name='feedback'\n                rows=\"3\"\n                onChange={updateFeedback}\n                placeholder=\"Do you have any feedback to provide the applicant?\"\n                value={feedback}\n                wide\n              />\n            }\n          />\n\n          <ReviewButtons onAccept={onAccept} onReject={onReject} disabled={false} />\n\n        </React.Fragment>\n      )}\n\n    </div>\n  )\n}\nReviewApplication.propTypes = {\n  issue: issueShape,\n  requestIndex: PropTypes.number.isRequired,\n  readOnly: PropTypes.bool.isRequired,\n}\n\nconst Estimations = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: auto;\n  grid-gap: 12px;\n`\n\nexport default ReviewApplication\n","/* eslint-disable import/no-unused-modules */\nexport { default } from './ReviewApplication'\n"]}